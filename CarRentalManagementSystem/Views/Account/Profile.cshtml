@model CarRentalManagementSystem.DTOs.CustomerResponseDTO

<div class="container">
    <div class="profile-form">
        <div class="profile-header">
            <div class="profile-avatar-large">
                @if (!string.IsNullOrEmpty(Model?.ImageUrl))
                {
                    <img src="@Model.ImageUrl" alt="profile" class="avatar-img-large" />
                }
                else
                {
                    <i data-lucide="user"></i>
                }
            </div>
            <h2 class="mb-0">My Profile</h2>
            <p class="text-muted">Manage your account information</p>
        </div>

        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                @TempData["SuccessMessage"]
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        }
        @if (TempData["ErrorMessage"] != null)
        {
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                @TempData["ErrorMessage"]
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        }

        <form asp-action="Profile" method="post" enctype="multipart/form-data">
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input class="form-control" asp-for="FullName" placeholder="Enter your full name" />
                        <span asp-validation-for="FullName" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input class="form-control" asp-for="Email" type="email" placeholder="Enter your email" />
                        <span asp-validation-for="Email" class="text-danger"></span>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="form-label">Phone Number</label>
                        <input class="form-control" asp-for="Phone" placeholder="Enter your phone number" pattern="^\d{10}$" title="Phone number must be exactly 10 digits" />
                        <small class="text-muted">Exactly 10 digits</small>
                        <span asp-validation-for="Phone" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="form-label">Address</label>
                        <textarea class="form-control" asp-for="Address" rows="3" placeholder="Enter your address"></textarea>
                        <span asp-validation-for="Address" class="text-danger"></span>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="form-label">NIC Number</label>
                        <input class="form-control" asp-for="NIC" placeholder="Enter your NIC number" pattern="^(?:\d{12}|\d{9}[VvXx])$" title="NIC must be 12 digits, or 9 digits followed by V or X" />
                        <small class="text-muted">12 digits, or 9 digits followed by V/X</small>
                        <span asp-validation-for="NIC" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="form-label">License Number</label>
                        <input class="form-control" asp-for="LicenseNo" placeholder="Enter your license number" pattern="^\d{10}[A-Za-z]{3}$" title="License number must be 10 digits followed by 3 letters" />
                        <small class="text-muted">10 digits followed by 3 letters</small>
                        <span asp-validation-for="LicenseNo" class="text-danger"></span>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="form-label">Profile Image</label>
                        <input type="file" name="imageFile" class="form-control" accept="image/*" id="profileImageInput" />
                        <div class="form-text">Upload a profile picture (JPG, PNG, GIF)</div>
                        <div class="mt-2">
                            <img id="profilePreview" src="@(Model?.ImageUrl ?? string.Empty)" alt="preview" class="avatar-preview @(string.IsNullOrEmpty(Model?.ImageUrl) ? "d-none" : string.Empty)" />
                        </div>
                    </div>
                </div>
            </div>

            <div class="d-flex gap-3 mt-4">
                <button type="submit" class="btn btn-primary">
                    <i data-lucide="save" class="me-2"></i>Save Changes
                </button>
                <a asp-controller="Customer" asp-action="Dashboard" class="btn btn-outline-secondary">
                    <i data-lucide="arrow-left" class="me-2"></i>Back to Dashboard
                </a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        document.addEventListener('DOMContentLoaded', function(){
            lucide.createIcons();
            const input = document.getElementById('profileImageInput');
            const preview = document.getElementById('profilePreview');
            if (input && preview) {
                input.addEventListener('change', function(e){
                    const file = e.target.files && e.target.files[0];
                    if (!file) return;
                    const url = URL.createObjectURL(file);
                    preview.src = url;
                    preview.classList.remove('d-none');
                });
            }
        });
    </script>
}


